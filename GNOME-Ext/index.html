<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="assets/style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div id="topbar">
        <div class="shell-element">
            <span>Desktop</span>
        </div>
        <div class="shell-element widget" id="showCalendar">
            <span>Jun 16 09:26</span>
            <div id="missionControl">
                <div id="notifications">
                    <div>
                        <b>Hint #1</b>
                        <span>Use the Shift key to open the overview</span>
                    </div>
                    <div>
                        <b>Hint #2</b>
                        <span>Use the Esc key to close the overview and the dock</span>
                    </div>
                    <div>
                        <b>Hint #3</b>
                        <span>Move the mouse to the bottom of the screen to enter in the cool mode</span>
                    </div>
                </div>
                <div id="calendar">
                    <div>
                        <span>S</span>
                        <span>M</span>
                        <span>T</span>
                        <span>W</span>
                        <span>T</span>
                        <span>F</span>
                        <span>S</span>
                    </div>
                    <div>
                        <span>27</span>
                        <span>28</span>
                        <span>29</span>
                        <span>30</span>
                        <span>31</span>
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                        <span>11</span>
                        <span class="active">12</span>
                        <span>13</span>
                        <span>14</span>
                        <span>15</span>
                        <span>16</span>
                        <span>17</span>
                        <span>18</span>
                        <span>19</span>
                        <span>20</span>
                        <span>21</span>
                        <span>22</span>
                        <span>23</span>
                        <span>24</span>
                        <span>25</span>
                        <span>26</span>
                        <span>27</span>
                        <span>28</span>
                        <span>29</span>
                        <span>30</span>
                        <span>31</span>
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="shell-element">
            <span>en</span>
            <span class="material-icons">wifi</span>
            <span class="material-icons">volume_up</span>
            <span class="material-icons">battery_charging_full</span>
        </div>
    </div>

    <div id="app">
        <img src="assets/nautilus.png" />
    </div>

    <div id="panel">
        <div id="pill"></div>

        <div id="dock" class="shell-element" style="display: flex; transform: translate(0, 0)">
            <div id="showApps">
                <span class="material-icons">apps</span>
            </div>
            <div>
                <img src="assets/firefox.svg" />
            </div>
            <div>
                <img src="assets/nautilus.svg" />
            </div>
            <div>
                <img src="assets/vscode.svg" />
            </div>
            <div>
                <img src="assets/spotify.svg" />
            </div>
            <div>
                <img src="assets/software.svg" />
            </div>
            <div class="widget">
                <img src="assets/widget-weather.svg" />
            </div>
        </div>

        <div id="overview" class="shell-element">
            <div id="toolbox">
                <div class="fill"></div>
                <div>
                    <input type="search" placeholder="Type to search" id="searchApps" />
                </div>
                <div class="widget fill">
                    <img src="assets/widget-weather.svg" />
                </div>
            </div>

            <div id="grid">
                <div>
                    <img src="assets/firefox.svg" />
                    <span>Firefox</span>
                </div>
                <div>
                    <img src="assets/nautilus.svg" />
                    <span>Files</span>
                </div>
                <div>
                    <img src="assets/vscode.svg" />
                    <span>Visual Studio Code</span>
                </div>
                <div>
                    <img src="assets/spotify.svg" />
                    <span>Spotify</span>
                </div>
                <div>
                    <img src="assets/software.svg" />
                    <span>Software</span>
                </div>
                <div>
                    <img src="assets/fonts.svg" />
                    <span>Fonts</span>
                </div>
                <div>
                    <img src="assets/icons.svg" />
                    <span>Icon Library</span>
                </div>
                <div>
                    <img src="assets/clocks.svg" />
                    <span>Clocks</span>
                </div>
                <div>
                    <img src="assets/text.svg" />
                    <span>Text Editor</span>
                </div>
                <div>
                    <img src="assets/music.svg" />
                    <span>Music</span>
                </div>
                <div>
                    <img src="assets/photo.svg" />
                    <span>Photos</span>
                </div>
                <div>
                    <img src="assets/roller.svg" />
                    <span>Archives</span>
                </div>
                <div>
                    <img src="assets/documents.svg" />
                    <span>Documents</span>
                </div>
                <div>
                    <img src="assets/emoji.svg" />
                    <span>Characters</span>
                </div>
                <div>
                    <img src="assets/calendar.svg" />
                    <span>Calendar</span>
                </div>
                <div>
                    <img src="assets/builder.svg" />
                    <span>Builder</span>
                </div>
                <div>
                    <img src="assets/bottles.svg" />
                    <span>Bottles</span>
                </div>
                <div>
                    <img src="assets/console.svg" />
                    <span>Console</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        const pill = document.getElementById('pill');
        const panel = document.getElementById('panel');
        const dock = document.getElementById('dock');
        const overview = document.getElementById('overview');
        const showApps = document.getElementById('showApps');
        const searchApps = document.getElementById('searchApps');
        const grid = document.getElementById('grid');
        const showAppWindow = document.querySelectorAll('#dock > div:not(#showApps)');
        const app = document.getElementById('app');
        const showCalendar = document.getElementById('showCalendar');
        const missionControl = document.getElementById('missionControl');

        let isDragging = false;
        let mouseDownCount = 0;
        let keepShowing = false;
        let showingComponent = 'dock';
        let desktopIsFree = true;
        let missionControlIsOpen = false;

        document.addEventListener('mousemove', (e) => {
            if (desktopIsFree) return;

            const mouseY = e.clientY;
            const windowHeight = window.innerHeight;
            if (mouseY >= (windowHeight - 10)) {
                showPill();
                mouseDownCount += 1;
                if (mouseDownCount >= 100) {
                    showDock();
                }
            }
        });

        panel.addEventListener('mouseleave', (e) => {
            if (desktopIsFree) return;
            if (keepShowing) return;

            mouseDownCount = 0;

            hidePill();
            hideDock();
        });

        pill.addEventListener('click', () => {
            if (showingComponent === 'dock') {
                hideDock();
                showOverview();
                return;
            }

            if (showingComponent === 'overview') {
                hideOverview();
                showingComponent = '';
                return;
            }

            showDock();
        });

        function showPill() {
            pill.style.transform = 'scale(1) translate(0, 0)';
        }

        function hidePill() {
            pill.style.transform = '';
        }

        function showDock() {
            showingComponent = 'dock';
            dock.style.display = 'flex';
            setTimeout(() => {
                dock.style.transform = 'scale(1)  translate(0, 0)';
            }, 100);
        }

        function hideDock(force = false) {
            if (force) {
                dock.style.display = 'none';
            }

            dock.style.transform = ' translate(0, 20rem)';
            setTimeout(() => {
                dock.style.display = 'none';
            }, 100);
        }

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        showApps.addEventListener('click', () => {
            hideDock(true);
            showOverview();
            keepShowing = true;
        });

        panel.addEventListener('click', (e) => {
            if (e.target.id !== 'panel') return;

            hideOverview();
            keepShowing = false;

            if (desktopIsFree) return;
            hideDock();
        });

        function showOverview() {
            showingComponent = 'overview';
            searchApps.focus();
            overview.style.display = 'flex';
            setTimeout(() => {
                overview.style.transform = 'scale(1)  translate(0, 0)';
            }, 100);
        }

        function hideOverview() {
            overview.style.transform = ' translate(0, 100vh)';
            setTimeout(() => {
                overview.style.display = 'none';
            }, 100);

            if (desktopIsFree) {
                showDock();
            }
        }

        searchApps.addEventListener('keyup', (e) => {
            const value = e.target.value.toLowerCase();
            const apps = grid.querySelectorAll('div');
            apps.forEach((app) => {
                const name = app.querySelector('span').innerText.toLowerCase();
                if (name.indexOf(value) > -1) {
                    app.style.display = 'block';
                } else {
                    app.style.display = 'none';
                }
            });
        });

        showAppWindow.forEach((app) => {
            app.addEventListener('click', () => {
                hideDock();
                hideOverview();
                keepShowing = false;
                desktopIsFree = false;
                showApp();
            });
        });

        function showApp() {
            app.style.display = 'block';
            setTimeout(() => {
                app.style.transform = 'scale(1)  translate(0, 0)';
            }, 100);
        }

        app.addEventListener('mousedown', (e) => {
            isDragging = true;
            const app = e.target;
            const appRect = app.getBoundingClientRect();
            const appWidth = appRect.width;
            const appHeight = appRect.height;
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            const appX = appRect.x;
            const appY = appRect.y;
            const offsetX = mouseX - appX;
            const offsetY = mouseY - appY;

            app.style.position = 'absolute';
            app.style.left = `${appX}px`;
            app.style.top = `${appY}px`;
            app.style.width = `${appWidth}px`;
            app.style.height = `${appHeight}px`;

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const mouseX = e.clientX;
                const mouseY = e.clientY;
                const newAppX = mouseX - offsetX;
                const newAppY = mouseY - offsetY;

                app.style.left = `${newAppX}px`;
                app.style.top = `${newAppY}px`;
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        });

        document.addEventListener('keyup', (e) => {
            if (e.keyCode === 27) { // Esc
                hideOverview();

                if (desktopIsFree) return;
                hideDock();
                keepShowing = false;
            }
            if (e.keyCode === 16) { // Shift
                hideDock();
                showOverview();
                keepShowing = true;
            }
        });

        showCalendar.addEventListener('click', () => {
            if (missionControlIsOpen) {
                hideMissionControl();
                return;
            }

            showMissionControl();
        });

        function showMissionControl() {
            missionControlIsOpen = true;
            missionControl.style.display = 'flex';
            setTimeout(() => {
                missionControl.style.transform = 'scale(1)';
            }, 100);
        }

        function hideMissionControl() {
            missionControlIsOpen = false;
            missionControl.style.transform = 'scale(0)';
            setTimeout(() => {
                missionControl.style.display = 'none';
            }, 100);
        }
    </script>
</body>

</html>